"use strict";(self.webpackChunk_minimal_material_kit_react=self.webpackChunk_minimal_material_kit_react||[]).push([[621],{11621:function(e,n,t){t.r(n),t.d(n,{default:function(){return g}});var a=t(65964),i=t(80941),r=t(76025),s=t(87130),l=t(24969),o=t(25465),c=t(80133),d=t(47313),u=t(1333),m=t(4862),v=t(46417);function g(){var e=(0,s.K$)().themeStretch,n=(0,c.nt)().translate,t=(0,u.I0)();return(0,d.useEffect)((function(){t((0,m.PQ)())}),[t]),(0,v.jsxs)(v.Fragment,{children:[(0,v.jsx)(a.ql,{children:(0,v.jsxs)("title",{children:[" ",n("cagnotte.add_cagnotte")]})}),(0,v.jsxs)(i.Z,{maxWidth:!e&&"lg",children:[(0,v.jsx)(l.Z,{heading:n("cagnotte.new_add_cagnotte"),links:[{name:n("Dashboard"),href:r.vB.general.homeComany},{name:n("cagnotte.cagnottes"),href:r.vB.cagnotte.list},{name:n("cagnotte.add_cagnotte")}]}),(0,v.jsx)(o.Z,{})]})]})}},25465:function(e,n,t){t.d(n,{Z:function(){return E}});var a=t(74165),i=t(15861),r=t(47313),s=t(69973),l=t(58467),o=t(75627),c=t(62563),d=t(32703),u=t(92484),m=t(62463),v=t(11154),g=t(58908),x=t(16157),f=t(34207),h=t(42669),p=t(34940),y=t(6621),j=t(73477),Z=t(10978),b=t(80133),I=t(1333),L=t(46417);function T(){var e=(0,o.Gc)(),n=e.control,t=e.watch,a=(0,b.nt)().translate,i=(0,I.v9)((function(e){return e.categories})).isLoading,r=(0,o.Dq)({control:n,name:"items"}),s=r.fields,l=r.append,c=r.remove,d=t(),u=[{id:"CULTURE",name:a("avantages.Culture")},{id:"SPORT",name:a("avantages.Sport")},{id:"HOLIDAYS",name:a("avantages.Holidays")},{id:"HELP",name:a("avantages.Personal_assistance")},{id:"GIFT",name:a("avantages.Gifts")},{id:"MOBILITY",name:a("avantages.Mobility")},{id:"REMOTE",name:a("avantages.Telework")}];return(0,L.jsx)(x.Z,{sx:{p:3},children:i?(0,L.jsx)(x.Z,{sx:{display:"flex",flex:1,alignItems:"center",justifyContent:"center",height:300,width:"100%"},children:(0,L.jsx)(f.Z,{size:40,color:"primary"})}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(h.Z,{variant:"h6",sx:{color:"text.disabled",mb:3},children:a("categorie.advantages")}),0===(null===s||void 0===s?void 0:s.length)?(0,L.jsx)(h.Z,{variant:"h5",style:{textAlign:"center",marginBottom:3},children:a("cagnotte.no_benefits")}):(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(m.Z,{divider:(0,L.jsx)(p.Z,{flexItem:!0,sx:{borderStyle:"dashed"}}),spacing:3,children:null===s||void 0===s?void 0:s.map((function(e,n){return(0,L.jsxs)(m.Z,{alignItems:"flex-end",spacing:1.5,children:[(0,L.jsxs)(m.Z,{direction:{xs:"column",md:"row"},spacing:2,sx:{width:1},children:[(0,L.jsxs)(v.Cc,{name:"items.".concat(n,".type"),size:"small",label:a("categorie.advantage"),InputLabelProps:{shrink:!0},SelectProps:{native:!1,MenuProps:{PaperProps:{sx:{maxHeight:220}}},sx:{textTransform:"capitalize"}},children:[(0,L.jsx)(p.Z,{}),u.map((function(e){var n;return(0,L.jsx)(y.Z,{value:e.id,sx:{mx:1,my:.5,borderRadius:.75,typography:"body2",textTransform:"capitalize","&:first-of-type":{mt:0},"&:last-of-type":{mb:0},display:null!==d&&void 0!==d&&null!==(n=d.items)&&void 0!==n&&n.find((function(n){return n.type===e.id}))?"none":"block"},children:e.name},e.id)}))]}),(0,L.jsx)(v.au,{size:"small",name:"items[".concat(n,"].yearlyLimit"),label:a("categorie.yearly_limit_amount")})]}),(0,L.jsx)(j.Z,{size:"small",color:"error",startIcon:(0,L.jsx)(Z.Z,{icon:"eva:trash-2-outline"}),onClick:function(){return function(e){c(e)}(n)},children:a("remove")})]},e.id)}))}),(0,L.jsx)(p.Z,{sx:{my:3,borderStyle:"dashed"}})]}),(0,L.jsx)(m.Z,{spacing:2,direction:{xs:"column-reverse",md:"row"},alignItems:{xs:"flex-start",md:"center"},children:(0,L.jsx)(j.Z,{size:"small",startIcon:(0,L.jsx)(Z.Z,{icon:"eva:plus-fill"}),onClick:function(){l({type:"",yearlyLimit:""})},sx:{flexShrink:0},disabled:d.items.length>6,children:a("add")})})]})})}function _(){var e=(0,b.nt)().translate;(0,o.Gc)().control;return(0,L.jsx)(m.Z,{spacing:2,direction:{xs:"column",sm:"row"},sx:{p:3},children:(0,L.jsx)(v.au,{name:"name",label:e("categorie.name")})})}var k=t(63129),S=t(2464);function E(e){var n=e.isEdit,t=e.currentCategory,x=(0,l.s0)(),f=(0,I.I0)(),h=(0,b.nt)().translate,p=(0,g.Ds)().enqueueSnackbar,y=(0,I.v9)((function(e){return e.categories})).isLoadingAction,j=(0,I.v9)((function(e){return e.auth})).company,Z=(0,I.v9)((function(e){return e.settings})).plafonds,E=s.object().shape({name:s.string().nullable().required(h("cagnotte.name_required")).max(20,h("cagnotte.name_length")),items:s.array().of(s.object().shape({type:s.string().required(h("cagnotte.advantage_required")),yearlyLimit:s.mixed().test("is-number-or-empty",h("invalid_value"),(function(e){return""===e||void 0===e||null===e||!isNaN(e)})).test({name:"max",test:function(e){var n,t=null===(n=this.parent)||void 0===n?void 0:n.type;if(t&&""!==t){var a={CULTURE:null!==Z?null===Z||void 0===Z?void 0:Z.CULTURE:999999,SPORT:null!==Z?null===Z||void 0===Z?void 0:Z.SPORT:999999,HOLIDAYS:null!==Z?null===Z||void 0===Z?void 0:Z.HOLIDAYS:999999,HELP:null!==Z?null===Z||void 0===Z?void 0:Z.HELP:999999,GIFT:null!==Z?Z.GIFT:999999,MOBILITY:null!==Z?null===Z||void 0===Z?void 0:Z.MOBILITY:999999,REMOTE:null!==Z?null===Z||void 0===Z?void 0:Z.REMOTE:999999}[t];if(!isNaN(e)&&e>a)return this.createError({message:"".concat(h("cagnotte.yearlyLimitMax")," ").concat(a||999999)})}return!0}})}))}),C=(0,r.useMemo)((function(){var e;return{items:(null===t||void 0===t||null===(e=t.advantages)||void 0===e?void 0:e.filter((function(e){return(null===e||void 0===e?void 0:e.type)!==k.KN.restaurant})))||[{type:"",yearlyLimit:null}],name:(null===t||void 0===t?void 0:t.name)||"",isStandard:null===t||void 0===t?void 0:t.isStandard}}),[t]),P=(0,o.cI)({mode:"onChange",resolver:(0,c.X)(E),defaultValues:C}),R=P.reset,w=P.handleSubmit;(0,r.useEffect)((function(){n&&t&&R(C),n||R(C)}),[n,t]);var O=function(){var e=(0,i.Z)((0,a.Z)().mark((function e(i){var r,s,l;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:r=[],s={name:i.name,advantages:r},l={type:"RESTAURANT",yearlyLimit:null,facialValue:null===j||void 0===j?void 0:j.ticketRestaurantFacialValue,facialValueCoveragePercent:null===j||void 0===j?void 0:j.ticketRestaurantFacialValueCoveragePercent},s.advantages.push(l),i.items.forEach((function(e){var n={type:e.type,yearlyLimit:parseInt(e.yearlyLimit)};s.advantages.push(n)})),f(n?(0,S.Rk)({dataToSend:s,navigate:x,id:t.id,translate:h,toast:p}):(0,S.hD)({dataToSend:s,navigate:x,translate:h,toast:p}));case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,L.jsx)(L.Fragment,{children:(0,L.jsxs)(v.ZP,{methods:P,children:[(0,L.jsxs)(u.Z,{children:[(0,L.jsx)(_,{}),(0,L.jsx)(T,{})]}),(0,L.jsx)(m.Z,{justifyContent:"flex-end",direction:"row",spacing:2,sx:{mt:3},children:(0,L.jsx)(d.Z,{size:"large",variant:"contained",loading:y,onClick:w(O),children:h("save")})})]})})}}}]);