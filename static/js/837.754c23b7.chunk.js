"use strict";(self.webpackChunk_minimal_material_kit_react=self.webpackChunk_minimal_material_kit_react||[]).push([[837],{11837:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ze}});var o=t(74165),r=t(15861),a=t(4942),i=t(1413),s=t(29439),l=t(65964),c=t(47313),u=t(85554),d=t(80941),h=t(16157),m=t(77914),p=t(79136),x=t(73477),f=t(34207),Z=t(42669),g=t(92484),v=t(39874),j=t(44874),S=t(90495),w=t(59629),y=t(37982),C=t(53805),D=t(18104),b=t(28326),E=t(99234),k=t(6621),M=t(61359),A=t(7081),O=t(5448),N=t(71235),I=t(66382),L=t(32091),P=t(87130),T=t(24969),_=t(50997),F=t(1333),z=t(10978),R=t(46095),W=t(46417),B=(0,R.Z)((0,W.jsx)("path",{d:"M16.59 8.59 12 13.17 7.41 8.59 6 10l6 6 6-6z"}),"ExpandMore"),H=(0,R.Z)((0,W.jsx)("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),V=t(63366),G=t(87462),q=t(83061),K=t(21921),X=t(31685),J=t(64164),$=t(62111),Q=t(11236),U=t(56127),Y=t(28170),ee=t(61107),ne=t(17551),te=t(32415),oe=t(32298),re=t(77430);function ae(e){return(0,oe.Z)("MuiSnackbarContent",e)}(0,re.Z)("MuiSnackbarContent",["root","message","action"]);var ie=["action","className","message","role"],se=(0,J.ZP)(te.Z,{name:"MuiSnackbarContent",slot:"Root",overridesResolver:function(e,n){return n.root}})((function(e){var n=e.theme,t="light"===n.palette.mode?.8:.98,o=(0,ne._4)(n.palette.background.default,t);return(0,G.Z)({},n.typography.body2,(0,a.Z)({color:n.vars?n.vars.palette.SnackbarContent.color:n.palette.getContrastText(o),backgroundColor:n.vars?n.vars.palette.SnackbarContent.bg:o,display:"flex",alignItems:"center",flexWrap:"wrap",padding:"6px 16px",borderRadius:(n.vars||n).shape.borderRadius,flexGrow:1},n.breakpoints.up("sm"),{flexGrow:"initial",minWidth:288}))})),le=(0,J.ZP)("div",{name:"MuiSnackbarContent",slot:"Message",overridesResolver:function(e,n){return n.message}})({padding:"8px 0"}),ce=(0,J.ZP)("div",{name:"MuiSnackbarContent",slot:"Action",overridesResolver:function(e,n){return n.action}})({display:"flex",alignItems:"center",marginLeft:"auto",paddingLeft:16,marginRight:-8}),ue=c.forwardRef((function(e,n){var t=(0,Q.Z)({props:e,name:"MuiSnackbarContent"}),o=t.action,r=t.className,a=t.message,i=t.role,s=void 0===i?"alert":i,l=(0,V.Z)(t,ie),c=t,u=function(e){var n=e.classes;return(0,K.Z)({root:["root"],action:["action"],message:["message"]},ae,n)}(c);return(0,W.jsxs)(se,(0,G.Z)({role:s,square:!0,elevation:6,className:(0,q.Z)(u.root,r),ownerState:c,ref:n},l,{children:[(0,W.jsx)(le,{className:u.message,ownerState:c,children:a}),o?(0,W.jsx)(ce,{className:u.action,ownerState:c,children:o}):null]}))}));function de(e){return(0,oe.Z)("MuiSnackbar",e)}(0,re.Z)("MuiSnackbar",["root","anchorOriginTopCenter","anchorOriginBottomCenter","anchorOriginTopRight","anchorOriginBottomRight","anchorOriginTopLeft","anchorOriginBottomLeft"]);var he=["onEnter","onExited"],me=["action","anchorOrigin","autoHideDuration","children","className","ClickAwayListenerProps","ContentProps","disableWindowBlurListener","message","onBlur","onClose","onFocus","onMouseEnter","onMouseLeave","open","resumeHideDuration","TransitionComponent","transitionDuration","TransitionProps"],pe=(0,J.ZP)("div",{name:"MuiSnackbar",slot:"Root",overridesResolver:function(e,n){var t=e.ownerState;return[n.root,n["anchorOrigin".concat((0,Y.Z)(t.anchorOrigin.vertical)).concat((0,Y.Z)(t.anchorOrigin.horizontal))]]}})((function(e){var n=e.theme,t=e.ownerState;return(0,G.Z)({zIndex:(n.vars||n).zIndex.snackbar,position:"fixed",display:"flex",left:8,right:8,justifyContent:"center",alignItems:"center"},"top"===t.anchorOrigin.vertical?{top:8}:{bottom:8},"left"===t.anchorOrigin.horizontal&&{justifyContent:"flex-start"},"right"===t.anchorOrigin.horizontal&&{justifyContent:"flex-end"},(0,a.Z)({},n.breakpoints.up("sm"),(0,G.Z)({},"top"===t.anchorOrigin.vertical?{top:24}:{bottom:24},"center"===t.anchorOrigin.horizontal&&{left:"50%",right:"auto",transform:"translateX(-50%)"},"left"===t.anchorOrigin.horizontal&&{left:24,right:"auto"},"right"===t.anchorOrigin.horizontal&&{right:24,left:"auto"})))})),xe=c.forwardRef((function(e,n){var t=(0,Q.Z)({props:e,name:"MuiSnackbar"}),o=(0,$.Z)(),r={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},a=t.action,i=t.anchorOrigin,l=(i=void 0===i?{vertical:"bottom",horizontal:"left"}:i).vertical,u=i.horizontal,d=t.autoHideDuration,h=void 0===d?null:d,m=t.children,p=t.className,x=t.ClickAwayListenerProps,f=t.ContentProps,Z=t.disableWindowBlurListener,g=void 0!==Z&&Z,v=t.message,j=t.onBlur,S=t.onClose,w=t.onFocus,y=t.onMouseEnter,C=t.onMouseLeave,D=t.open,b=t.resumeHideDuration,E=t.TransitionComponent,k=void 0===E?ee.Z:E,M=t.transitionDuration,A=void 0===M?r:M,O=t.TransitionProps,N=(O=void 0===O?{}:O).onEnter,I=O.onExited,L=(0,V.Z)(t.TransitionProps,he),P=(0,V.Z)(t,me),T=(0,G.Z)({},t,{anchorOrigin:{vertical:l,horizontal:u}}),_=function(e){var n=e.classes,t=e.anchorOrigin,o={root:["root","anchorOrigin".concat((0,Y.Z)(t.vertical)).concat((0,Y.Z)(t.horizontal))]};return(0,K.Z)(o,de,n)}(T),F=c.useRef(),z=c.useState(!0),R=(0,s.Z)(z,2),B=R[0],H=R[1],J=(0,U.Z)((function(){S&&S.apply(void 0,arguments)})),ne=(0,U.Z)((function(e){S&&null!=e&&(clearTimeout(F.current),F.current=setTimeout((function(){J(null,"timeout")}),e))}));c.useEffect((function(){return D&&ne(h),function(){clearTimeout(F.current)}}),[D,h,ne]);var te=function(){clearTimeout(F.current)},oe=c.useCallback((function(){null!=h&&ne(null!=b?b:.5*h)}),[h,b,ne]);return c.useEffect((function(){if(!g&&D)return window.addEventListener("focus",oe),window.addEventListener("blur",te),function(){window.removeEventListener("focus",oe),window.removeEventListener("blur",te)}}),[g,oe,D]),c.useEffect((function(){if(D)return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)};function e(e){e.defaultPrevented||"Escape"!==e.key&&"Esc"!==e.key||S&&S(e,"escapeKeyDown")}}),[B,D,S]),!D&&B?null:(0,W.jsx)(X.Z,(0,G.Z)({onClickAway:function(e){S&&S(e,"clickaway")}},x,{children:(0,W.jsx)(pe,(0,G.Z)({className:(0,q.Z)(_.root,p),onBlur:function(e){j&&j(e),oe()},onFocus:function(e){w&&w(e),te()},onMouseEnter:function(e){y&&y(e),te()},onMouseLeave:function(e){C&&C(e),oe()},ownerState:T,ref:n,role:"presentation"},P,{children:(0,W.jsx)(k,(0,G.Z)({appear:!0,in:D,timeout:A,direction:"top"===l?"down":"up",onEnter:function(e,n){H(!1),N&&N(e,n)},onExited:function(e){H(!0),I&&I(e)}},L,{children:m||(0,W.jsx)(ue,(0,G.Z)({message:v,action:a},f))}))}))}))})),fe=xe;function Ze(){var e=(0,P.K$)().themeStretch,n=(0,c.useState)(new Date),t=(0,s.Z)(n,2),R=t[0],V=t[1],G=(0,c.useState)(0),q=(0,s.Z)(G,2),K=q[0],X=q[1],J=(0,c.useState)(5),$=(0,s.Z)(J,2),Q=$[0],U=$[1],Y=(0,c.useState)(!1),ee=(0,s.Z)(Y,2),ne=ee[0],te=(ee[1],(0,c.useState)([])),oe=(0,s.Z)(te,2),re=oe[0],ae=oe[1],ie=(0,c.useState)([]),se=(0,s.Z)(ie,2),le=se[0],ce=se[1],ue=(0,c.useState)({}),de=(0,s.Z)(ue,2),he=de[0],me=de[1],pe=(0,u.v9)((function(e){return e.data})),xe=pe.data,Ze=void 0===xe?[]:xe,ge=pe.loading;pe.error;(0,c.useEffect)((function(){R&&ve(R)}),[R]);(0,c.useEffect)((function(){if(Array.isArray(Ze)&&Ze.length>0){var e=Ze.map((function(e){return{id:e.expenseId,nom:"".concat(e.lastName," ").concat(e.firstName),montantDemande:e.amount,montantValide:e.amountAccepted,date:new Date(e.date).toLocaleDateString(),categorie:e.advantage,category:e.category,position:e.position,registrationNumber:e.registrationNumber,firstname:e.firstName,lastname:e.lastName,amountAccepted:void 0!==e.EmployerAmountAccepted&&null!==e.EmployerAmountAccepted?e.EmployerAmountAccepted:0,status:e.EmployerStatus&&""!==e.EmployerStatus?e.EmployerStatus:"ACCEPTED",totalAmount:e.totalAmount,totalAmountAccepted:e.totalAmountAccepted,totalAmountAcceptedByEmployer:e.totalAmountAcceptedByEmployer,new_employees_subscription_amount:e.new_employees_subscription_amount,refund_management_fees:e.refund_management_fees,total:e.total,employeeExpensesStatus:e.employeeExpensesStatus}}));ae(e);var n=e.reduce((function(e,n){var t=e.find((function(e){return e.personName===n.nom}));return t?t.expenses.push(n):e.push({personName:n.nom,expenses:[n]}),e}),[]);ce(n)}else ae([]),ce([])}),[Ze]),console.log("the data:",Ze);var ve=function(e){if(e){V(e);var n=new Date(e);n.setMonth(n.getMonth()-1),n.setDate(25);var t=n.toISOString().split("T")[0],o=new Date(e);o.setDate(24);var r=o.toISOString().split("T")[0];console.log("startttttdaaateee:",t),console.log("enddddddateeee:",r),(0,F.WI)((0,_.WF)({startDate:t,endDate:r}))}else V(null)},je=(0,c.useState)(!1),Se=(0,s.Z)(je,2),we=(Se[0],Se[1]),ye=function(){var e=(0,r.Z)((0,o.Z)().mark((function e(n,t){var r,a,s,l;return(0,o.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:we(!0),ae((function(e){return e.map((function(e){return e.id===n?(0,i.Z)((0,i.Z)({},e),{},{status:t}):e}))})),(0,F.WI)((0,_.ZH)({id:n,status:t})),R&&(V(R),console.log("inside the if-statement for selectedDate!!"),(r=new Date(R)).setMonth(r.getMonth()-1),r.setDate(25),a=r.toISOString().split("T")[0],(s=new Date(R)).setDate(24),l=s.toISOString().split("T")[0],(0,F.WI)((0,_.WF)({startDate:a,endDate:l})),console.log("inside the if-statement fetchDataStart: ",Ze),window.location.reload()),we(!1);case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),Ce=(0,u.v9)((function(e){return e.data})),De=(Ce.updateLoading,Ce.updateStatus,(0,c.useState)({open:!1,id:null,newStatus:null})),be=(0,s.Z)(De,2),Ee=be[0],ke=be[1],Me=function(e){e&&null!==Ee.id&&Ee.newStatus&&ye(Ee.id,Ee.newStatus),ke({open:!1,id:null,newStatus:null})},Ae=function(e){return e.toISOString().split("T")[0]},Oe=(0,u.v9)((function(e){return e.data.snackbar})),Ne=function(){(0,F.WI)((0,_.p2)())};return(0,W.jsxs)("div",{children:[(0,W.jsx)(l.ql,{children:(0,W.jsx)("title",{children:"Facturation List Page"})}),(0,W.jsxs)(d.Z,{maxWidth:!e&&"lg",children:[(0,W.jsx)(T.Z,{heading:"Facturation List",links:[{name:"Dashboard",href:"/"},{name:"Facturation",href:"/facturation"},{name:"List"}]}),(0,W.jsxs)(h.Z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,W.jsx)(L.M,{label:"Month",openTo:"month",views:["month"],value:R,onChange:ve,renderInput:function(e){return(0,W.jsx)(m.Z,(0,i.Z)({},e))},inputFormat:"MMMM yyyy"}),(0,W.jsx)(fe,{open:Oe.open,autoHideDuration:6e3,onClose:Ne,anchorOrigin:{vertical:"top",horizontal:"right"},children:(0,W.jsx)(p.Z,{onClose:Ne,severity:"error",children:Oe.message})}),(0,W.jsxs)(h.Z,{sx:{display:"flex",gap:2,ml:"auto"},children:[(0,W.jsx)(x.Z,{variant:"contained",color:"primary",onClick:function(){return function(){if(R){var e=new Date(R);e.setMonth(e.getMonth()-1),e.setDate(25);var n=e.toISOString().split("T")[0],t=new Date(R);t.setDate(24);var o=t.toISOString().split("T")[0];console.log("Downloading CSV for:",n,o),(0,F.WI)((0,_.zk)({startDate:n,endDate:o}))}else console.error("No date selected")}()},sx:{mb:2},startIcon:(0,W.jsx)(z.Z,{icon:"solar:import-bold"}),children:"Download CSV"}),(0,W.jsx)(x.Z,{variant:"contained",color:"error",onClick:function(){return console.log("Downloading PDF"),void(0,F.WI)((0,_.Fc)())},sx:{mb:2},startIcon:(0,W.jsx)(z.Z,{icon:"solar:import-bold"}),children:"Download PDF"})]})]}),ge?(0,W.jsx)(h.Z,{sx:{display:"flex",justifyContent:"center",mt:3},children:(0,W.jsx)(f.Z,{})}):0===re.length?(0,W.jsx)(Z.Z,{variant:"h6",sx:{mt:3,textAlign:"center"},children:"No data available for the selected date range."}):(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(g.Z,{sx:{mt:3},children:[(0,W.jsx)(v.Z,{sx:{maxWidth:"100%",overflowX:"auto"},children:(0,W.jsxs)(j.Z,{size:ne?"small":"medium",children:[(0,W.jsx)(S.Z,{children:(0,W.jsxs)(w.Z,{children:[(0,W.jsx)(y.Z,{children:"Matricule"}),(0,W.jsx)(y.Z,{children:"Nom"}),(0,W.jsx)(y.Z,{children:"Montant demand\xe9"}),(0,W.jsx)(y.Z,{children:"Montant valid\xe9"}),(0,W.jsx)(y.Z,{children:"valid\xe9 par soci\xe9t\xe9"}),(0,W.jsx)(y.Z,{sx:{minWidth:70},children:"Abonnement"}),(0,W.jsx)(y.Z,{children:"frais de gestion"}),(0,W.jsx)(y.Z,{children:"Total"}),(0,W.jsx)(y.Z,{children:"Status"}),(0,W.jsx)(y.Z,{})]})}),(0,W.jsx)(C.Z,{children:le.slice(K*Q,K*Q+Q).map((function(e,n){var t,o,r,s,l,c,u,d,h,m,p;return(0,W.jsxs)(W.Fragment,{children:[(0,W.jsxs)(w.Z,{children:[(0,W.jsx)(y.Z,{children:null===(t=e.expenses[0])||void 0===t?void 0:t.registrationNumber}),(0,W.jsx)(y.Z,{children:e.personName}),(0,W.jsx)(y.Z,{children:null===(o=e.expenses[0])||void 0===o?void 0:o.totalAmount}),(0,W.jsx)(y.Z,{children:null===(r=e.expenses[0])||void 0===r?void 0:r.totalAmountAccepted}),(0,W.jsx)(y.Z,{children:null===(s=e.expenses[0])||void 0===s?void 0:s.totalAmountAcceptedByEmployer}),(0,W.jsx)(y.Z,{children:null===(l=e.expenses[0])||void 0===l?void 0:l.new_employees_subscription_amount}),(0,W.jsx)(y.Z,{children:null===(c=e.expenses[0])||void 0===c?void 0:c.refund_management_fees}),(0,W.jsx)(y.Z,{children:null===(u=e.expenses[0])||void 0===u?void 0:u.total}),(0,W.jsx)(y.Z,{sx:{color:"REJECTED"===(null===(d=e.expenses[0])||void 0===d?void 0:d.employeeExpensesStatus)?"red":"ACCEPTED"===(null===(h=e.expenses[0])||void 0===h?void 0:h.employeeExpensesStatus)?"green":"MODIFIED"===(null===(m=e.expenses[0])||void 0===m?void 0:m.employeeExpensesStatus)?"blue":"inherit",fontWeight:"bold"},children:null===(p=e.expenses[0])||void 0===p?void 0:p.employeeExpensesStatus}),(0,W.jsx)(y.Z,{align:"right",children:(0,W.jsx)(D.Z,{onClick:function(){return n=e.personName,void me((function(e){return(0,i.Z)((0,i.Z)({},e),{},(0,a.Z)({},n,!e[n]))}));var n},children:he[e.personName]?(0,W.jsx)(H,{}):(0,W.jsx)(B,{})})})]},e.personName+n),(0,W.jsx)(w.Z,{children:(0,W.jsx)(y.Z,{colSpan:8,sx:{p:0},children:(0,W.jsx)(b.Z,{in:he[e.personName],timeout:"auto",unmountOnExit:!0,children:(0,W.jsxs)(j.Z,{size:"small",sx:{width:"108%",marginLeft:"10%",backgroundColor:"#F9FAFB"},children:[(0,W.jsx)(S.Z,{children:(0,W.jsxs)(w.Z,{sx:{backgroundColor:"#F4F6F8"},children:[(0,W.jsx)(y.Z,{children:"Montant demand\xe9"}),(0,W.jsx)(y.Z,{children:"Montant valid\xe9"}),(0,W.jsx)(y.Z,{children:"Date"}),(0,W.jsx)(y.Z,{children:"Avantages"}),(0,W.jsx)(y.Z,{children:"Status"})]})}),(0,W.jsx)(C.Z,{children:e.expenses.slice(0).map((function(e){return(0,W.jsxs)(w.Z,{children:[(0,W.jsx)(y.Z,{children:e.montantDemande}),(0,W.jsx)(y.Z,{children:e.montantValide}),(0,W.jsx)(y.Z,{children:e.date}),(0,W.jsx)(y.Z,{children:e.categorie}),(0,W.jsx)(y.Z,{children:(0,W.jsxs)(E.Z,{value:e.status,onChange:function(n){return t=e.id,o=n.target.value,void ke({open:!0,id:t,newStatus:o});var t,o},children:[(0,W.jsx)(k.Z,{value:"ACCEPTED",sx:{color:"#55baaa"},children:"Accept"}),(0,W.jsx)(k.Z,{value:"PENDING",sx:{color:"red"},children:"Reject"})]})})]},e.id)}))})]})})})})]})}))})]})}),(0,W.jsx)(M.Z,{rowsPerPageOptions:[5,10,25],component:"div",count:re.length,rowsPerPage:Q,page:K,onPageChange:function(e,n){X(n)},onRowsPerPageChange:function(e){U(parseInt(e.target.value,10)),X(0)}})]}),(0,W.jsx)(h.Z,{sx:{display:"flex",justifyContent:"flex-end",width:"100%"},children:(0,W.jsx)(x.Z,{variant:"contained",color:"primary",onClick:function(){if(R){var e=new Date(R);e.setMonth(e.getMonth()-1),e.setDate(25);var n=Ae(e),t=new Date(R);t.setDate(24);var o=Ae(t);console.log("Sending notification:",n,o),(0,F.WI)((0,_.Ve)({startDate:n,endDate:o}))}else console.error("No date selected")},disabled:ge,sx:{m:2},children:ge?"Sending...":"Send Notification"})}),(0,W.jsxs)(A.Z,{open:Ee.open,onClose:function(){return ke({open:!1,id:null,newStatus:null})},children:[(0,W.jsx)(O.Z,{children:"Confirm Status Change"}),(0,W.jsx)(N.Z,{children:(0,W.jsxs)(Z.Z,{children:["Are you sure you want to change the status of this item to"," ",Ee.newStatus,"?"]})}),(0,W.jsxs)(I.Z,{children:[(0,W.jsx)(x.Z,{onClick:function(){return Me(!1)},color:"primary",children:"Cancel"}),(0,W.jsx)(x.Z,{onClick:function(){return Me(!0)},color:"primary",children:"Confirm"})]})]})]})]})]})}}}]);